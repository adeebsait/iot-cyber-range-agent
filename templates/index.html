<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Real-Time IoT Alerts</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <style>
      body { font-family: Arial, sans-serif; margin: 1em; }
      #alerts { margin-top: 1em; }
      .alert { padding: 0.5em; border-bottom: 1px solid #ddd; }
    </style>
  </head>
  <body>
    <h1>Real-Time IoT Alerts</h1>
    <div id="alerts"></div>

    <script>
      console.log("Dashboard loaded, connecting to SocketIOâ€¦");
      const socket = io();

      socket.on('connect', () => {
        console.log("Socket connected!");
      });
      socket.on('disconnect', () => {
        console.log("Socket disconnected");
      });

      socket.on('new_alert', data => {
        console.log("Received new_alert:", data);
        const div = document.createElement('div');
        div.className = 'alert';
        div.textContent = `${data.time} ALERT from ${data.src_ip} (votes: ${JSON.stringify(data.votes)})`;
        document.getElementById('alerts').prepend(div);
      });
    </script>
  </body>
</html>
